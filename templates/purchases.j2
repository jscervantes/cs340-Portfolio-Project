{% extends "base.j2" %}

{% block content %}
    <h2>Purchases</h2>
    <div id="browse">
        <table>
            {% if data %}
                <thead>
                    <tr>
                        {% for key in data[0].keys() %}
					    <th scope="col" data-field="{{ key }}" data-filter-control="input">{{ key }}</th>
                        {% endfor %} 
                    </tr>

                    <tbody>
                        {% for item in data %}
                        <tr>
                            {% for key in item.keys() %}
                                <td> {{item[key]}} </td>
                            {%endfor %}
                        </tr>
                        {% endfor %} 
            {% endif %}
        </table>

        <td><button id="add-button" onclick="showAddForm()">Add</button></td>
    </div>

    <p><i>When a customer places an order, our store, Ciani Synths, must fulfill the customer's
     order by placing a purchase order from the manufacturer, which is what Purchases represent. This allows
     the customer's order to be dropshipped directly from the manufacturer.
     Each purchase generates at least one purchaseSynthesizer. Each purchaseSynthesizer
    in a purchase represents the quantity of a specific synthesizer being purchased.</i></p>

    <div id="insert">
    <form method="post" id="Add_Purchase" style="display: none;">
    <legend><strong>Add A Purchase to Database</strong></legend>
    <fieldset>
        <br>
        {% if orderIds %}
          <label for="orderID">Order</label>
          <select id="orderID" name="orderID">
              <option value="" selected>NULL</option>
              {% for order in orderIds %}
                <option value="{{order.orderID}}">{{ order.orderID }}</option>
              {% endfor %}
          </select>
        {% endif %}
        <br>
        {% if manufacturerIds %}
          <label for="manufacturerID">Manufacturer</label>
          <br>
          <select required id="manufacturerID" name="manufacturerID">
              <option value="" disabled selected>Select the Manufacturer</option>
                {% for manufacturer in manufacturerIds %}
                  <option value="{{manufacturer.manufacturerID}}">{{ manufacturer.manufacturerID }} : {{ manufacturer.manufacturerName }}</option>
                {% endfor %}
          </select>
        {% endif %}
        <br>
        <label for="order-date">Purchase Date</label>
        <br>
        <input type="date" 
               id="purchaseDate"
               name="purchaseDate"
               placeholder="Purchase Date"
               value="{{ request.form['purchase-date'] }}"
               required>
        <br>
        <label for="cost">Purchase Cost</label>
        <br>
        <div id="purchase-line-items">
            <!-- Line items will be added here -->
        </div>
        <button type="button" onclick="addPurchaseItem()">Add Line Item</button>
        <br>
      </fieldset>
      <button type="submit" value="Submit Purchase" name="Add_Purchase">Submit</button>
    </form>
    </div>


<!--Javascript-->
<script>
countPurchaseItems = 0;
 function showAddForm() {
  document.getElementById('Add_Purchase').style.display = 'block';
 }

 function addPurchaseItem() {
    countPurchaseItems++;
    const container = document.getElementById('purchase-line-items');
    const newPurchaseItem = document.createElement('div');
    newPurchaseItem.innerHTML = `
        <h5>Item ${countPurchaseItems}</h5>
          {% if synthesizersNames %}
            <label for="synthesizerID${countPurchaseItems}">Synthesizers</label>
            <select required id="synthesizerID${countPurchaseItems}" name="synthesizerID${countPurchaseItems}">
                <option value="" disabled selected>Select the Synthesizer</option>
                {% for synthesizer in synthesizersNames %}
                  <option value="{{synthesizer.synthesizerID}}">ID: {{synthesizer.synthesizerID}} {{synthesizer.synthesizerName}}</option>
                {% endfor %}
            </select>
          {% endif %}
        <br>
        <label for="quantity${countPurchaseItems}">Quantity</label>
        <br>
        <input type="number" 
            id="quantity${countPurchaseItems}"
            name="quantity${countPurchaseItems}"
            min = "1"
            required>
        <br>
    `;
    container.appendChild(newPurchaseItem);
}
</script>
{% endblock content %}